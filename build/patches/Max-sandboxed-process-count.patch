From: wuyifeng <wuyifeng@nd.com.cn>
Date: Wed, 26 Jul 2023 13:47:27 +0800
Subject: AP9-14224 As a user, I would like the chromium browser to utilize sandbox process strategy to optimize the Chromium memory.

Fix version: 2.0.0
Set the max sandboxed process count to 5.

---
 .../src/org/chromium/base/process_launcher/BindService.java    | 3 +--
 .../chromium/base/process_launcher/ChildProcessConnection.java | 3 +--
 chrome/android/java/AndroidManifest.xml                        | 2 +-
 3 files changed, 3 insertions(+), 5 deletions(-)

diff --git a/base/android/java/src/org/chromium/base/process_launcher/BindService.java b/base/android/java/src/org/chromium/base/process_launcher/BindService.java
--- a/base/android/java/src/org/chromium/base/process_launcher/BindService.java
+++ b/base/android/java/src/org/chromium/base/process_launcher/BindService.java
@@ -29,8 +29,7 @@ final class BindService {
     private static Method sBindServiceAsUserMethod;

     static boolean supportVariableConnections() {
-        return Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q
-                && !BuildConfig.IS_INCREMENTAL_INSTALL;
+        return false;
     }

     // Note that handler is not guaranteed to be used, and client still need to correctly handle
diff --git a/base/android/java/src/org/chromium/base/process_launcher/ChildProcessConnection.java b/base/android/java/src/org/chromium/base/process_launcher/ChildProcessConnection.java
--- a/base/android/java/src/org/chromium/base/process_launcher/ChildProcessConnection.java
+++ b/base/android/java/src/org/chromium/base/process_launcher/ChildProcessConnection.java
@@ -50,8 +50,7 @@ import javax.annotation.concurrent.GuardedBy;
 public class ChildProcessConnection {
     private static final String TAG = "ChildProcessConn";
     private static final int FALLBACK_TIMEOUT_IN_SECONDS = 10;
-    private static final boolean SUPPORT_NOT_PERCEPTIBLE_BINDING =
-            Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q;
+    private static final boolean SUPPORT_NOT_PERCEPTIBLE_BINDING = false;

     /**
      * Used to notify the consumer about the process start. These callbacks will be invoked before
diff --git a/chrome/android/java/AndroidManifest.xml b/chrome/android/java/AndroidManifest.xml
--- a/chrome/android/java/AndroidManifest.xml
+++ b/chrome/android/java/AndroidManifest.xml
@@ -1154,7 +1154,7 @@ by a child template that "extends" this file.

       <!-- NOTE: If you change the value of "android:process" for the below services,
            you also need to update kHelperProcessExecutableName in chrome_constants.cc. -->
-      {% set num_sandboxed_services = 40 %}
+      {% set num_sandboxed_services = 5 %}
       <meta-data android:name="org.chromium.content.browser.NUM_SANDBOXED_SERVICES"
           android:value="{{ num_sandboxed_services }}"/>

--

