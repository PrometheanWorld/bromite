From: Yifeng <wuyifeng@nd.com.cn>
Date: Fri, 5 Nov 2021 05:53:00 +0000
Subject: Force accessibility text scaling

This ensures that when we set text scaling, it will work on all web pages.

---
 third_party/blink/renderer/core/layout/text_autosizer.cc | 6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

diff --git a/third_party/blink/renderer/core/layout/text_autosizer.cc b/third_party/blink/renderer/core/layout/text_autosizer.cc
--- a/third_party/blink/renderer/core/layout/text_autosizer.cc
+++ b/third_party/blink/renderer/core/layout/text_autosizer.cc
@@ -689,7 +689,7 @@ void TextAutosizer::UpdatePageInfo() {
              (static_cast<float>(
                   page_info_.shared_info_.main_frame_layout_width) /
               page_info_.shared_info_.main_frame_width) >
-         1.0f);
+         0.0f);
   }

   if (page_info_.page_needs_autosizing_) {
@@ -1223,14 +1223,12 @@ void TextAutosizer::ApplyMultiplier(LayoutObject* layout_object,
     // multiplier. Only apply the accessibility factor if the autosizer has
     // determined a multiplier should be applied so that text-size-adjust:none
     // does not cause a multiplier to be applied when it wouldn't be otherwise.
-    bool should_apply_accessibility_font_scale_factor = multiplier > 1;
     multiplier = current_style.GetTextSizeAdjust().Multiplier();
-    if (should_apply_accessibility_font_scale_factor)
-      multiplier *= page_info_.accessibility_font_scale_factor_;
   } else if (multiplier < 1) {
     // Unlike text-size-adjust, the text autosizer should only inflate fonts.
     multiplier = 1;
   }
+  multiplier *= page_info_.accessibility_font_scale_factor_;

   if (current_style.TextAutosizingMultiplier() == multiplier)
     return;
2.17.1