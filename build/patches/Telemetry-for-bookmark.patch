From 25d365824c6e509a94c4117240b071d3d828bcf9 Mon Sep 17 00:00:00 2001
From: wuyifeng <wuyifeng@nd.com.cn>
Date: Fri, 16 Dec 2022 11:42:24 +0800
Subject: Telemetry event for adding to bookmark

Fix version: 1.2.1
Create TelemetryUtils class for managing Telemetry event.
Add the 'Website Saved To Bookmarks' telemetry event.
Relate to AP9-11097.

---
 .../src/org/chromium/base/TelemetryUtils.java | 11 +++++++++++
 .../browser/bookmarks/BookmarkBridge.java     |  2 +
 .../offlinepages/OfflinePageUtils.java        |  2 +
 3 files changed, 81 insertions(+), 30 deletions(-)
 create mode 100755 base/android/java/src/org/chromium/base/TelemetryUtils.java

diff --git a/base/android/java/src/org/chromium/base/TelemetryUtils.java b/base/android/java/src/org/chromium/base/TelemetryUtils.java
--- a/base/android/java/src/org/chromium/base/TelemetryUtils.java
+++ b/base/android/java/src/org/chromium/base/TelemetryUtils.java
@@ -13,8 +13,10 @@ import org.json.JSONObject;
 public class TelemetryUtils {

     private static final String EVENT_VIDEO_FULL_SCREEN = "Chromium Video Player Full Screen Mode";
+    private static final String EVENT_WEBSITE_SAVED_TO_BOOKMARKS = "Website Saved To Bookmarks";

     private static final String KEY_VIDEO_FULL_SCREEN = "Video Player in Chromium Full Screen Mode";
+    private static final String KEY_WEBSITE_BOOKMARKED = "Website Bookmarked";

     private static final String VALUE_VIDEO_FULL_SCREEN = "Full screen mode selected in browser video player";

@@ -37,6 +39,15 @@ public class TelemetryUtils {
         }
     }

+    public static void sendWebsiteSavedToBookmarksEvent(String url) {
+        try {
+            JSONObject eventData = new JSONObject();
+            eventData.put(KEY_WEBSITE_BOOKMARKED, url);
+            sendEvent(EVENT_WEBSITE_SAVED_TO_BOOKMARKS, eventData);
+        } catch (Throwable ignored) {
+        }
+    }
+
     private static void sendEvent(String eventName, JSONObject eventData) {
         Telemetry.send(eventName, eventData);
     }
diff --git a/chrome/android/java/src/org/chromium/chrome/browser/bookmarks/BookmarkBridge.java b/chrome/android/java/src/org/chromium/chrome/browser/bookmarks/BookmarkBridge.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/bookmarks/BookmarkBridge.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/bookmarks/BookmarkBridge.java
@@ -31,6 +31,7 @@ import com.google.protobuf.InvalidProtocolBufferException;
 import org.chromium.base.ContextUtils;
 import org.chromium.base.Log;
 import org.chromium.base.ObserverList;
+import org.chromium.base.TelemetryUtils;
 import org.chromium.base.ThreadUtils;
 import org.chromium.base.annotations.CalledByNative;
 import org.chromium.base.annotations.NativeMethods;
@@ -1066,6 +1067,7 @@ class BookmarkBridge {
             Log.e(TAG,
                     "Failed to add bookmarks: parentTypeAndId %s", parent);
         }
+        TelemetryUtils.sendWebsiteSavedToBookmarksEvent(tab.getUrl().getSpec());
         return bookmarkId;
      }

diff --git a/chrome/android/java/src/org/chromium/chrome/browser/offlinepages/OfflinePageUtils.java b/chrome/android/java/src/org/chromium/chrome/browser/offlinepages/OfflinePageUtils.java
--- a/chrome/android/java/src/org/chromium/chrome/browser/offlinepages/OfflinePageUtils.java
+++ b/chrome/android/java/src/org/chromium/chrome/browser/offlinepages/OfflinePageUtils.java
@@ -19,6 +19,7 @@ import org.chromium.base.ApplicationStatus;
 import org.chromium.base.Callback;
 import org.chromium.base.ContentUriUtils;
 import org.chromium.base.Log;
+import org.chromium.base.TelemetryUtils;
 import org.chromium.base.metrics.RecordHistogram;
 import org.chromium.base.metrics.RecordUserAction;
 import org.chromium.base.task.AsyncTask;
@@ -276,6 +277,7 @@ public class OfflinePageUtils {
             @Override
             public void onSavePageDone(int savePageResult, String url, long offlineId) {
                 // Result of the call is ignored.
+                TelemetryUtils.sendWebsiteSavedToBookmarksEvent(url);
             }
         });
     }
--
2.34.1